# Global Agent Configuration
[agent]
  interval = "10s" # Default polling interval, cocok dengan skrip Python Anda
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  debug = false # Set ke true untuk debugging jika perlu
  quiet = false
  hostname = ""
  omit_hostname = false

# Output Plugin: InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"] # Menggunakan nama service dari docker-compose
  token = "th1s_1s_a_v3ry_s3cur3_4nd_l0ng_4dm1n_t0k3n_f0r_d3v" # Token dari environment InfluxDB Anda
  organization = "iot_project_alpha" # Organisasi dari environment InfluxDB Anda
  bucket = "sensor_data_primary" # Bucket dari environment InfluxDB Anda
  # timeout = "5s"
  # insecure_skip_verify = false

# Input Plugins: HTTP, satu instance per perangkat

# Perangkat 1: ID LOGGER:2D3032, LOKASI:F2, IP ADDRESS:10.6.0.2
[[inputs.http]]
  urls = ["http://10.6.0.2/"]
  name_override = "sensor_reading" # Nama measurement di InfluxDB
  method = "GET"
  timeout = "5s" # Timeout permintaan HTTP
  data_format = "grok"
  # Pola Grok untuk mem-parsing data: humidity#temperature#hex_id_from_data
  # Juga mencoba menangani jika data terbungkus dalam <body>...</body> secara opsional
  grok_patterns = ["(?:%{GREEDYDATA}<body>)?%{NUMBER:humidity:float}#%{NUMBER:temperature:float}#%{NOTSPACE:hex_id_from_data:string}(?:</body>%{GREEDYDATA})?"]
  
  # Tag spesifik untuk perangkat ini
  [inputs.http.tags]
    device_id = "2D3032"
    location = "F2"
    source_ip = "10.6.0.2"

# Perangkat 2: ID LOGGER:2D303B, LOKASI:F3, IP ADDRESS:10.6.0.3
[[inputs.http]]
  urls = ["http://10.6.0.3/"]
  name_override = "sensor_reading"
  method = "GET"
  timeout = "5s"
  data_format = "grok"
  grok_patterns = ["(?:%{GREEDYDATA}<body>)?%{NUMBER:humidity:float}#%{NUMBER:temperature:float}#%{NOTSPACE:hex_id_from_data:string}(?:</body>%{GREEDYDATA})?"]

  [inputs.http.tags]
    device_id = "2D303B"
    location = "F3"
    source_ip = "10.6.0.3"

# --- INSTRUKSI UNTUK PERANGKAT LAIN ---
# Untuk menambahkan perangkat lain dari device_list.csv, salin blok [[inputs.http]] di atas,
# dan perbarui nilai untuk `urls`, `device_id`, `location`, dan `source_ip`
# sesuai dengan setiap baris di file CSV Anda.
# Contoh:
#
# [[inputs.http]]
#   urls = ["http://<IP_ADDRESS_PERANGKAT_BERIKUTNYA>/"]
#   name_override = "sensor_reading"
#   method = "GET"
#   timeout = "5s"
#   data_format = "grok"
#   grok_patterns = ["(?:%{GREEDYDATA}<body>)?%{NUMBER:humidity:float}#%{NUMBER:temperature:float}#%{NOTSPACE:hex_id_from_data:string}(?:</body>%{GREEDYDATA})?"]
#
#   [inputs.http.tags]
#     device_id = "<ID_LOGGER_PERANGKAT_BERIKUTNYA>"
#     location = "<LOKASI_PERANGKAT_BERIKUTNYA>"
#     source_ip = "<IP_ADDRESS_PERANGKAT_BERIKUTNYA>"
